# This file is part of the Social Recipes.
#
# For the full copyright and license information, please view the LICENSE
# file that was distributed with this source code.
#
# @author Ruben Garcia <ruben.garcia@opendeusto.es>

services:
    catch_return_message_bus:
        class: Ajgl\SimpleBus\Message\Bus\Middleware\CatchReturnMessageBusSupportingMiddleware

    app.query_bus:
        class: LIN3S\SharedKernel\Infrastructure\Application\SimpleBus\SimpleBusQueryBus
        arguments: ['@catch_return_message_bus']

    app.command_bus:
        class: LIN3S\SharedKernel\Infrastructure\Application\SimpleBus\SimpleBusCommandBus
        arguments:
            - "@command_bus"


    app.security.authenticator.social:
        class: App\Infrastructure\Symfony\Security\SocialAuthenticator
        arguments:
            - "@knpu.oauth2.registry"
            - "@router"
            - "@app.command_bus"
            - "@app.query_bus"
            - "@app.graph_api.facebook"

    #Command-Handlers
    app.application.command.user.facebook_login:
        class: App\Application\Command\Session\FacebookLogInClientHandler
        arguments:
            - "@bengor_user.user.repository"
            - "@doctrine.orm.entity_manager"
        tags:
            -
                name: command_handler
                handles: App\Application\Command\Session\FacebookLogInClientCommand

    app.graph_api.facebook:
      class: Facebook\Facebook
      arguments:
        - 'app_id': '%oauth_facebook_client_id%'
          'app_secret': '%oauth_facebook_client_secret%'
          'default_graph_version': 'v2.10'

